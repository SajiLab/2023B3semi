# B3プログラミングゼミ 第2回

今回実施する内容は以下の通りです。

* 画像平滑化
  * 移動平均法
  * メディアンフィルタ
* 2値化画像
  * 膨張
  * 収縮

実装の際は以下のようなことを考えてみてください。(ひょっとしたら考察のネタになるかも...)

- 膨張と収縮はお互いにどのような関係になっているか
- 画素の隣接パターンは全部で何種類存在するか
- ノイズはすべて削除できたか
- ノイズ除去には他にどのような手段が考えられるか

## 画像平滑化

平滑化とは画像の画素値を平らで滑らかにする手法です。平滑化を行なうことで、画像中のノイズを軽減することができます。

<div style="text-align: center;">
<img src=semi_img/2_smooth.png>

図１　画像平滑化イメージ
</div>

### 移動平均法(moving average method)

平均化フィルタを用いて、注目画素を周辺の値の平均値に設定する手法です。

ノイズは軽減されますが、全体的にぼやけた画像となります。

<div style="text-align: center;">
<img src=semi_img/2_move.png>

図２　移動平均法イメージ
</div>



### メディアンフィルタ

注目画素の周囲に局所領域を設定し、その領域内での中央値を求め、注目画素の値を中央値の値とする手法です。

ノイズのみ除去することができ、出力画像もあまりぼやけないという特徴があります。

<div style="text-align: center;">
<img src=semi_img/2_median.png>

図４　メディアンフィルタイメージ
</div>

`filtering.cpp`にて既に実装済みのプログラムがありますので、確認してみてください。


## 2値化

2値化とは画素値が閾値以上の場合ならば白、それ以外なら黒というように2値の画像に変換する処理であり、グレースケール化した画像に対して行ないます。閾値の決定のための手法はいくつかあり、代表的なものに**大津の2値化**が挙げられます。

今回のゼミでは簡略化のため、閾値をあらかじめ引数として手動で決定しています。
<span style="color: red; ">R</span>,<span style="color: green; ">G</span>,<span style="color: blue; ">B</span>



### 膨張・収縮

この説明では背景色が黒、前景色を白と仮定します。以下の説明内の`穴`とは白の画素を指します。

### 膨張

背景または穴に接する対象の画素について、画素をひとまわり加え、穴を大きくする処理です。注目画素の8近傍のうち、どれか1つでも白なら注目画素を白くします。

<div style="text-align: center;">
<img src=semi_img/2_dilation.png>

図１　膨張処理
</div>

### 収縮

背景または穴に接する対象の画素について、画素をひとまわり剥ぎ取り、穴を小さくする処理です。注目画素の8近傍のうち、どれか1つでも黒なら注目画素を黒くします。

<div style="text-align: center;">
<img src=semi_img/2_erosion.png>

図２　収縮処理
</div>

膨張と収縮を組み合わせた処理はそれぞれ**オープニング**、**クロージング**と呼ばれます。オープニングは収縮->膨張の順で処理を行うことで、画像中の小さな連結成分(ノイズ)を消すことができます。クロージングはその逆処理であり、膨張->収縮の順で処理を行うことで画像中の穴を消すことができます。

これらは総じて**モルフォロジー演算**と呼ばれています。


## 実装課題

今回は入力画像に対するモルフォロジー演算処理を実装します。

`img`ファイル内にある`lenna.bmp`に対し2値化処理を施した画像、膨張処理を施した画像、収縮処理を施した画像を計3枚作成してください。

処理を実装するファイルは以下の通りです。

- `myImage.hpp`：ヘッダファイル
   - クラスの定義
   - 関数のプロトタイプ宣言
- `binarize.cpp`：2値化、モルフォロジー演算を行うソースファイル
- `main.cpp`：`main`関数が記述されているソースファイル


自分で新しくファイルを作成する、処理を追加する等は問題ありません。想定された処理が実装できる範囲内で、より良い処理を実装してみてください。

###  実装時のポイント
- 周囲8近傍について探索を行なう場合、画像の端に当たる場所の処理には注意が必要です。例えば、座標(x, y) = (0,0)にの画素に対して8近傍の探索を行なうと`segmentation fault`となります。

- パターン認識の講義では省略されましたが、今回は画像の端1ピクセルに対しても処理を実装する必要があります。どの近傍に画素が存在し、どのように処理をすれば膨張、収縮が実現されるのかよく検討してから実装してみてください。

- `長くても変数名はわかりやすいものにしましょう。`どのような値が変数に格納されるのか直感的にわかりやすくなるだけでなく、他の人がコードを読む際にも役立ちます。




